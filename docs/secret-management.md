# Secret Management

Snyk Code Local Engine makes use of Kubernetes Secrets to authenticate access to internal components. By default, these secrets are managed by the Helm Chart.

The inbuilt secret lifecycle is:

1. On installation, create Opaque secrets using the `randAlphaNum` Helm function to generate values for required keys which are then base64 encoded and persisted to the deployment.
2. On upgrade, Helm will attempt to lookup the value(s) of a pre-existing secret:
   1. If the lookup succeeds (a value exists on the cluster), Helm will not re-generate the secret.
   2. If the lookup fails, Helm will re-generate the secret.

To use an external secret management solution with Snyk Code Local Engine, the following steps may be followed:

## External Secrets

First create secrets for consumption by Snyk Code Local Engine. Then instruct Snyk Code Local Engine to consume these secrets, disabling the inbuilt secret generation mechanism.

### Creating Secrets

Create secrets in the namespace Snyk Code Local Engine will be deployed to. Secrets are expressed with required key(s) and the format of the value(s) required. Any regex strings are provided to indicate the value that _would_ be automatically generated by Snyk Code Local Engine if using the internal secret mechanism:

#### Session Secret

Function: Used for internal session authentication

| Key | Format | Internal Secret Autogenerated Value |
| --- | --- | --- |
| `SESSION_SECRET` | Alphanumeric string | `[a-zA-Z0-9]{64}` |

#### Redis Secrets

Function: Used to secure access to any Redis deployments

| Key | Format | Internal Secret Autogenerated Value |
| --- | --- | --- |
| `REDIS_PASSWORD` | Alphanumeric string | `[a-zA-Z0-9]{32}` |

#### MongoDB Secrets

Function: Used to secure access to MongoDB deployments, and for internal authentication between MongoDB components

| Key | Format | Internal Secret Autogenerated Value |
| --- | --- | --- | 
| `mongodb-root-password` | Alphanumeric string | `[a-zA-Z0-9]{16}` |

### Consuming Secrets

Update the `values-customer-settings.yaml` file to match the following:

```YAML
global:
  localEngine:
    sessionSecretName: << the name of the secret created >>
    redisSecretName: << the name of the secret created >>
    mongodbSecretName: << the name of the secret created >>
```